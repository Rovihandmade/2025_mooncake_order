<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>【Rovi蘿薇手作烘培】2025 中秋禮盒 預購中</title>
    <!-- 引入 Font Awesome 圖示 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- CSS 樣式 (直接內嵌) -->
    <style>
/* 基本重置 */
body, h1, h2, h3, p, ul, li {
    margin: 0;
    padding: 0;
    list-style: none;
}

body {
    font-family: 'Noto Sans TC', sans-serif;
    line-height: 1.6;
    color: #333;
    background-color: #f8f5ee; /* 淺米色背景 */
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

/* 標題與段落 */
h1, h2, h3 {
    font-weight: 700;
    color: #5a4b40; /* 深棕色 */
}

h1 {
    font-size: 2.8em;
    margin-bottom: 20px;
}

h2 {
    font-size: 2.2em;
    margin-bottom: 30px;
    text-align: center;
}

h3 {
    font-size: 1.5em;
    margin-bottom: 10px;
}

p {
    margin-bottom: 15px;
}

.section {
    padding: 80px 0;
}

.section-description {
    text-align: center;
    max-width: 700px;
    margin: 0 auto 50px;
    color: #666;
    font-size: 1.1em;
}

/* 按鈕 */
.btn {
    display: inline-block;
    padding: 12px 25px;
    border-radius: 5px;
    text-decoration: none;
    font-weight: 700;
    transition: background-color 0.3s ease;
    cursor: pointer;
    border: none;
    font-size: 1em;
}

.primary-btn {
    background-color: #e6b268; /* 暖金色 */
    color: #fff;
}

.primary-btn:hover {
    background-color: #d1a15f;
}

.secondary-btn {
    background-color: #f0f0f0;
    color: #5a4b40;
    border: 1px solid #ccc;
}

.secondary-btn:hover {
    background-color: #e0e0e0;
}

/* Header */
header {
    background-color: #fff;
    padding: 15px 0;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    position: sticky;
    top: 0;
    z-index: 1000;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo {
    font-size: 1.8em;
    font-weight: 700;
    color: #e6b268;
}

nav a {
    margin-left: 30px;
    color: #5a4b40;
    text-decoration: none;
    font-weight: 400;
    transition: color 0.3s ease;
}

nav a:hover {
    color: #e6b268;
}

.cart-icon {
    position: relative;
    font-size: 1.5em;
    color: #5a4b40;
    cursor: pointer;
}

#cart-count {
    position: absolute;
    top: -8px;
    right: -10px;
    background-color: #e6b268;
    color: #fff;
    border-radius: 50%;
    padding: 2px 6px;
    font-size: 0.7em;
    font-weight: 700;
}

/* Hero Section (No Image) */
.hero-section {
    background-color: #f0f0e0; /* 淺黃褐色或米色 */
    color: #5a4b40;
    text-align: center;
    padding: 150px 20px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: 400px; /* 降低高度，不再是大圖背景 */
}

.hero-section.hero-no-image {
    background: linear-gradient(to bottom, #fdfaf5, #f8f5ee); /* 漸層背景 */
    color: #5a4b40;
}

.hero-text {
    max-width: 800px;
}

.hero-text h1 {
    color: #5a4b40;
    font-size: 3em; /* 調整字體大小 */
    line-height: 1.2;
    text-shadow: none; /* 移除陰影 */
}

.hero-text p {
    font-size: 1.2em; /* 調整字體大小 */
    margin-bottom: 40px;
    text-shadow: none; /* 移除陰影 */
}

/* About Section (Removed About Img specific style) */
.about-section {
    text-align: center;
    background-color: #fdfaf5;
}

/* New Photo Gallery Section */
.photo-gallery-section {
    background-color: #fff;
    padding: 80px 0;
    text-align: center;
}

.gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
    margin-top: 40px;
}

.gallery-item {
    background-color: #fdfaf5;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    overflow: hidden;
    text-align: center;
    transition: transform 0.3s ease-in-out;
    height: 300px; /* 保持 gallery-item 的固定高度 */
    display: flex; 
    flex-direction: column; 
    /* 【核心修改】將 justify-content 改為 center，讓所有內容（圖片和文字）在容器中垂直居中 */
    justify-content: center; 
    align-items: center; /* 讓內容水平居中 */
    gap: 5px; /* 【新增】在圖片和文字之間增加一點間距 */
}

.gallery-item:hover {
    transform: translateY(-5px);
}

.gallery-item img {
    width: 100%;
    height: auto; /* 【修改】讓高度自動適應 */
    max-height: 250px; /* 【修改】設置一個最大高度，防止圖片過高 */
    object-fit: contain; /* 【修改】確保圖片完整顯示，不裁切，可能會有留白 */
    display: block; 
    margin: 0 auto; /* 【新增】水平居中 */
    flex-shrink: 0; /* 【新增】防止圖片在 flex 容器中被壓縮 */
}

.gallery-item p {
    padding: 15px;
    font-size: 1.05em;
    color: #5a4b40;
    font-weight: 500;
    margin: 0;
}


/* Products Section (Modified for no images) */
.products-section {
    background-color: #fff;
}

.product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
}

.product-card {
    background-color: #fdfaf5; /* 淺色背景 */
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    overflow: hidden;
    text-align: center;
    padding: 25px; /* 增加整體內邊距 */
    display: flex;
    flex-direction: column;
    justify-content: space-between; /* 均勻分佈內容 */
}

.product-card h3 {
    color: #e6b268;
    margin-bottom: 15px; /* 增加間距 */
    font-size: 1.8em; /* 放大品項名稱 */
    line-height: 1.2;
}

.product-card .description {
    font-size: 1em; /* 調整大小 */
    color: #666;
    height: auto; /* 不再限制固定高度，讓文字自然延伸 */
    overflow: visible;
    text-overflow: clip;
    -webkit-line-clamp: unset; /* 取消行數限制 */
    -webkit-box-orient: unset;
    padding: 0; /* 移除多餘 padding */
    margin-bottom: 20px; /* 增加間距 */
}

.product-card .price {
    font-size: 1.5em; /* 放大價格 */
    font-weight: 700;
    color: #5a4b40;
    margin-bottom: 20px; /* 增加間距 */
    padding: 0;
}

.product-card .original-price {
    text-decoration: line-through;
    color: #999;
    font-size: 0.9em; /* 相對縮小原價 */
    margin-right: 8px;
}

.quantity-control {
    margin-bottom: 20px; /* 增加間距 */
}

.add-to-cart-btn {
    width: 100%; /* 確保按鈕寬度 */
    margin-top: auto; /* 保持在底部 */
}

/* Cart Summary Section */
.cart-summary-section {
    background-color: #fdfaf5;
    border-top: 1px solid #eee;
    transition: all 0.5s ease-in-out;
}

.cart-summary-section.hidden {
    display: none !important;
    opacity: 0 !important;
    transform: translateY(20px);
}

.cart-items {
    border: 1px solid #eee;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    background-color: #fff;
}

.cart-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px dashed #eee;
}

.cart-item:last-child {
    border-bottom: none;
}

.cart-item-info {
    flex-grow: 1;
}

.cart-item-info h4 {
    margin-bottom: 5px;
    color: #5a4b40;
}

.cart-item-info span {
    color: #888;
    font-size: 0.9em;
}

.cart-item-controls {
    display: flex;
    align-items: center;
}

.cart-item-controls .quantity-control {
    margin: 0 15px;
}

.cart-item-controls .item-subtotal {
    font-weight: 700;
    color: #e6b268;
    width: 80px;
    text-align: right;
}

.cart-item-controls .remove-btn {
    background-color: transparent;
    border: none;
    color: #f44336;
    cursor: pointer;
    font-size: 1.2em;
    margin-left: 15px;
}

.cart-item-controls .remove-btn:hover {
    color: #d32f2f;
}

.cart-total {
    font-size: 1.5em;
    font-weight: 700;
    text-align: right;
    margin-top: 20px;
    color: #5a4b40;
}

.cart-total #cart-total-amount {
    color: #e6b268;
}

#proceed-to-form-btn, #clear-cart-btn {
    margin-top: 20px;
    width: 100%;
}
#clear-cart-btn {
    margin-top: 10px;
}

/* Order Info Section */
.order-info-section {
    background-color: #fff;
    text-align: center;
}

.info-blocks {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    margin-top: 40px;
}

.info-block {
    background-color: #fdfaf5;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    text-align: left;
}

.info-block h3 {
    color: #e6b268;
    border-bottom: 2px solid #e6b268;
    padding-bottom: 10px;
    margin-bottom: 20px;
}

.info-block ul {
    list-style: none;
}

.info-block li {
    margin-bottom: 10px;
    color: #555;
}

.info-block li i {
    margin-right: 10px;
    color: #e6b268;
}

.important-note {
    margin-top: 40px;
    font-size: 1.1em;
    color: #e6b268;
}

/* Contact Section */
.contact-section {
    background-color: #f8f5ee;
    text-align: center;
}

.contact-section ul {
    margin-top: 30px;
}

.contact-section li {
    margin-bottom: 10px;
    font-size: 1.1em;
    color: #555;
}

.contact-section li i {
    margin-right: 10px;
    color: #e6b268;
}

.social-links {
    margin-top: 30px;
}

.social-links a {
    font-size: 2em;
    color: #5a4b40;
    margin: 0 15px;
    transition: color 0.3s ease;
}

.social-links a:hover {
    color: #e6b268;
}

/* Footer */
footer {
    background-color: #5a4b40;
    color: #eee;
    padding: 30px 0;
    text-align: center;
    font-size: 0.9em;
}

footer a {
    color: #e6b268;
    text-decoration: none;
    margin: 0 10px;
}

footer a:hover {
    text-decoration: underline;
}

/* Responsive Design */
@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
    }
    nav {
        margin-top: 15px;
    }
    nav a {
        margin: 0 10px;
    }
    .hero-text h1 {
        font-size: 2.5em;
    }
    .hero-text p {
        font-size: 1.1em;
    }
    h2 {
        font-size: 1.8em;
    }
    .product-grid {
        grid-template-columns: 1fr;
    }
    .info-blocks {
        grid-template-columns: 1fr;
    }
    .gallery-grid { 
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .logo {
        font-size: 1.5em;
    }
    nav {
        display: none; 
    }
    .hero-text h1 {
        font-size: 2em;
    }
    .hero-text p {
        font-size: 1em;
    }
    .section {
        padding: 50px 0;
    }
    .product-card .add-to-cart-btn {
        width: calc(100% - 30px);
    }
}

.hidden {
    display: none !important;
    opacity: 0 !important;
}

/* 新增產品卡片圖片容器樣式 */
.product-image-container {
    width: 100%;
    height: 180px; /* 固定圖片容器高度 */
    overflow: hidden;
    margin-bottom: 15px; /* 與下方文字內容間隔 */
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #f8f8f8; /* 圖片載入前的背景色 */
}

.product-image-container img {
    width: 100%;
    height: 100%; /* 讓圖片填滿容器 */
    object-fit: contain; /* 確保圖片完整顯示，不裁切，可能會有留白 */
    display: block;
}

/* 新增產品卡片無圖片佔位符樣式 */
.product-image-placeholder {
    width: 100%;
    height: 180px; /* 與圖片容器高度相同 */
    background-color: #f0f0f0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    color: #888;
    font-size: 0.9em;
    padding: 15px;
    box-sizing: border-box;
    margin-bottom: 15px;
    border: 1px dashed #ccc;
}
.product-image-placeholder h3 {
    color: #5a4b40;
    font-size: 1.2em;
    margin-bottom: 5px;
}
.product-image-placeholder p {
    margin: 0;
    font-size: 0.9em;
}

/* 包裹產品文字內容的 div */
.product-card .product-content {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    flex-grow: 1; /* 讓內容佔滿剩餘空間 */
    padding: 0 15px 15px; /* 調整內邊距 */
}
.product-card h3,
.product-card .description,
.product-card .price {
    padding: 0; /* 移除 product-card 內部的 padding */
    margin-left: 0;
    margin-right: 0;
}
.product-card {
    padding: 0; /* 移除最外層 product-card 的 padding，改為由 product-content 控制 */
}
        
    </style>
</head>
<body>

    <header>
        <div class="container header-content">
            <div class="logo">Rovi蘿薇手作烘培</div>
            <nav>
                <a href="#about">關於我們</a>
                <a href="#photo-gallery">禮盒款式</a>
                <a href="#order-info">預購須知</a>
                <a href="#products">品項介紹</a>
                <a href="#contact">聯絡我們</a>
            </nav>
            <div class="cart-icon">
                <i class="fas fa-shopping-cart"></i>
                <span id="cart-count">0</span>
            </div>
        </div>
    </header>

    <main>
        <section id="hero" class="hero-section hero-no-image"> 
            <div class="hero-text">
                <h1>月圓人團圓，暖心手作中秋獻禮</h1>
                <p>嚴選食材，匠心烘焙。預購優惠中，為您與摯愛獻上最真摯的祝福。</p>
                <a href="#products" class="btn primary-btn">立即選購</a>
            </div>
        </section>

        <section id="about" class="section about-section container">
            <h2>手作的溫度，家的心意</h2>
            <p>Rovi蘿薇手作烘培堅持手工製作每一份點心，嚴選天然食材，將對烘焙的熱情與對家人的心意揉入其中。在這個中秋佳節，我們希望透過暖心的手作禮盒，為您與摯愛傳遞一份最純粹的祝福與感動。</p>
        </section>

        <!-- 相片集區塊 -->
        <section id="photo-gallery" class="section photo-gallery-section container">
            <h2>2025年禮盒款式</h2>
            <p>主打4款手提禮盒，數量有限，將依照預購順位優先出貨</p>
            <div class="gallery-grid">
                <div class="gallery-item">
                    <img src="https://i.postimg.cc/pTp0k0Sh/image.jpg" alt="2025年禮盒款式1"> <!-- 請替換 -->
                    <p>款式1</p>
                </div>
                <div class="gallery-item">
                    <img src="https://i.postimg.cc/KjT0h1xm/image.jpg" alt="2025年禮盒款式2"> <!-- 請替換 -->
                    <p>款式2</p>
                </div>
                <div class="gallery-item">
                    <img src="https://i.postimg.cc/05KWwBmh/V1.png" alt="2025年禮盒款式3"> <!-- 請替換 -->
                    <p>款式3</p>
                </div>
                <div class="gallery-item">
                    <img src="https://i.postimg.cc/nzg3W48d/image.jpgg" alt="2025年禮盒款式4"> <!-- 請替換 -->
                    <p>款式4</p>
                </div>
                <div class="gallery-item">
                    <img src="https://i.postimg.cc/MTx1gKV7/image.jpg" alt=" "> <!-- 請替換 -->
                <p>產品展示1</p>
                </div>
                <div class="gallery-item">
                    <img src="https://i.postimg.cc/sxg7D6n1/image.jpg" alt=" "> <!-- 請替換 -->
                <p>產品展示2</p>
                </div>
                <div class="gallery-item">
                    <img src="https://i.postimg.cc/htkLb0G3/image.jpg" alt=" "> <!-- 請替換 -->
                <p>產品展示3</p>
                </div>
                <div class="gallery-item">
                    <img src="https://i.postimg.cc/tJvP13fk/image.jpg" alt=" "> <!-- 請替換 -->
                <p>產品展示4</p>
                </div>
            </div>
        </section>

        <section id="order-info" class="section order-info-section container">
            <h2>中秋預購須知</h2>
            <p class="note">
                手工製作數量有限，為確保品質。<br>
                **請務必參考 Google 訂購表單中「面交/寄出日期」問題旁的【每日額度說明】，以便選擇日期。**
            </p>
            <div class="info-blocks">
                <div class="info-block">
                    <h3>預購期間</h3>
                    <p>即日起至 2025/09/21 星期日 止。</p>
                    <p>手工限量製作，敬請提早預購。</p>
                </div>
                <div class="info-block">
                    <h3>付款方式</h3>
                    <ul>
                        <li>轉帳匯款：於提交訂單後，匯款帳號將於訂單確認信中提供，並請於24小時內完成匯款，謝謝。</li>
                        <li>LINE PAY轉帳：須加LINE好友。</li>
                    </ul>
                </div>
                <div class="info-block">
                    <h3>取貨/配送說明</h3>
                    <ul>
                        <li>面交：請於預訂時選擇面交日期、時間與地點。</li>
                        <li>宅配：請於預訂時選擇物流業者(7-11/郵局)、寄件日期，將配合於該日期出貨。</li>
                        <li>常溫宅配運費：將依實際材積及物流業者訂價收取。</li>
                    </ul>
                </div>
            </div>
            <p class="important-note"><strong>重要提醒：</strong> 您的訂單將在收到款項後正式成立，並依您選擇的日期出貨。</p>
        </section>

        <section id="products" class="section products-section container">
            <h2>Rovi蘿薇手作烘培 2025 中秋禮盒系列</h2>
            <p class="section-description">品味經典，探索新意。多款中秋限定手作烘焙，滿足您對佳節美味的所有期待。</p>

            <div class="product-grid" id="product-list">
                <!-- 產品將由 JavaScript 動態生成 -->
            </div>
        </section>

        <section id="cart-summary-section" class="section cart-summary-section container hidden">
            <h2>您的訂單明細</h2>
            <div class="cart-items" id="cart-items-display">
                <p>購物車是空的。</p>
            </div>
            <div class="cart-total">
                總計：<span id="cart-total-amount">$0</span>
            </div>
            <button id="proceed-to-form-btn" class="btn primary-btn">確認訂單，前往Google表單填寫資訊</button>
            <button id="clear-cart-btn" class="btn secondary-btn">清空購物車</button>
        </section>

        <section id="contact" class="section contact-section container">
            <h2>與我們聯繫</h2>
            <p>若有任何疑問或特殊需求，歡迎隨時與我們聯繫！</p>
            <ul>
                <li><i class="fas fa-envelope"></i> Email：rovihandmade@gmail.com</li>
                <li><i class="fas fa-clock"></i> 營業時間：每日9:00AM-20:00PM</li>
            </ul>
            <div class="social-links">
                <a href="https://www.facebook.com/share/1Fjos2Lw4h/?mibextid=wwXIfr" target="_blank"><i class="fab fa-facebook-square"></i></a>
                <a href="https://www.instagram.com/rovihandmade?igsh=Nm1najZxd3Q3c3hn" target="_blank"><i class="fab fa-instagram-square"></i></a>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Rovi蘿薇手作烘培。保留所有權利。</p>
            <p><a href="#">隱私權政策</a> | <a href="#">服務條款</a></p>
        </div>
    </footer>

    <!-- JavaScript 程式碼 (直接內嵌，已修正所有問題) -->
    <script>
// 將 GOOGLE_FORM_ID 和 PRODUCT_QUANTITY_ENTRY_IDS 直接在這裡定義 (硬編碼)
const GOOGLE_FORM_ID = '1FAIpQLSeEyB2hoKkuFdFzjPW34Z4X57UB1yXg5fjashv5bCn96gfeAA'; // 您的 Google 表單 ID
const PRODUCT_QUANTITY_ENTRY_IDS = { // 您的品項數量欄位 ID
    'uodousha': '531001400',
    'greendousha': '2026671317',
    'mixed_egg_yolk': '1127966981',
    'pure_mung_bean': '2072600674',
    'floss_mung_bean': '179437994',
    'mixed_mung_bean': '1204106198',
    'mixed_all': '600143959' // 已修正為正確的 ID
};

// 產品資料 (請根據您的實際品項和價格修改)
const products = [
    {
        id: 'uodousha',
        name: '烏豆沙蛋黃酥',
        originalPrice: 390,
        specialPrice: 360,
        description: '綿密醇厚的烏豆沙，完美包覆油潤鹹香的金黃鹹蛋黃，甜鹹交織的經典滋味。',
        image: 'https://i.postimg.cc/wTP4Jktf/v1.png', // 【新增/修改】請替換為 Imgur/Postimages 直接連結
        unit: '盒'
    },
    {
        id: 'greendousha',
        name: '綠豆沙蛋黃酥',
        originalPrice: 390,
        specialPrice: 360, 
        description: '細緻清甜的綠豆沙，搭配飽滿鹹蛋黃，口感清新不膩，蛋黃酥愛好者的雅致之選，經典熱銷！',
        image: 'https://i.postimg.cc/rpGfBXf3/v2.png', // 【新增/修改】請替換
        unit: '盒'
    },
    {
        id: 'mixed_egg_yolk',
        name: '綜合蛋黃酥',
        originalPrice: 390,
        specialPrice: 360,
        description: '烏豆沙、綠豆沙各3入，一次品嚐兩種風味，滿足不同喜好，是雙重美味的絕佳選擇。',
        image: 'https://i.postimg.cc/kGY1TQT5/image.jpg', // 【新增/修改】即使是綜合，也放一張代表性圖片
        unit: '盒'
    },
    {
        id: 'pure_mung_bean',
        name: '純綠豆椪',
        originalPrice: 360,
        specialPrice: 330,
        description: '懷舊古早味，層層酥鬆餅皮，綠豆沙入口即化，選擇減糖配方，甜而不膩。',
        image: 'https://i.postimg.cc/CKpvrLsb/v5.png', // 【新增/修改】請替換
        unit: '盒'
    },
    {
        id: 'floss_mung_bean',
        name: '肉鬆綠豆椪',
        originalPrice: 390,
        specialPrice: 360,
        description: '獨特鹹香，香酥肉鬆與細緻綠豆沙的巧妙結合，鹹甜交織，口感豐富令人回味。',
        image: 'https://i.postimg.cc/NM4PHqTm/image.png', // 【新增/修改】請替換
        unit: '盒'
    },
    {
        id: 'mixed_mung_bean',
        name: '綜合綠豆椪',
        originalPrice: 375,
        specialPrice: 345,
        description: '純綠豆、肉鬆各3入，純粹與創新的搭配，一次擁有兩種經典綠豆椪風味。',
        image: 'https://i.postimg.cc/4NnFm03H/image.jpg', // 【新增/修改】
        unit: '盒'
    },
    {
        id: 'mixed_all',
        name: '綜合蛋黃酥+肉鬆綠豆椪',
        originalPrice: 390,
        specialPrice: 360,
        description: '圓滿推薦！精選烏豆沙蛋黃酥、綠豆沙蛋黃酥及肉鬆綠豆椪各2入，一次滿足您的所有渴望。',
        image: 'https://i.postimg.cc/XqY1KHch/image.jpg', // 【新增/修改】
        unit: '盒'
    }
];

// 購物車
let cart = [];

// DOM 元素 (先用 let 宣告，在 DOMContentLoaded 後賦值)
let productList;
let cartCountSpan;
let cartSummarySection;
let cartItemsDisplay;
let cartTotalAmountSpan;
let proceedToFormBtn;
let clearCartBtn;
let cartIcon;


// ====== 功能函數 ======


function renderProducts() {
    if (!productList) {
        console.error('Error: #product-list element not found in HTML. Cannot render products.');
        return;
    }

    productList.innerHTML = '';
    products.forEach(product => {
        const isSpecialOffer = product.specialPrice < product.originalPrice;
        const specialPricePrefix = isSpecialOffer ? '預購優惠價 ' : '';

        // 【核心修改】判斷是否有圖片，然後生成對應的 HTML
        const productImageHtml = product.image ?
            `<div class="product-image-container"><img src="${product.image}" alt="${product.name}"></div>` :
            `<div class="product-image-placeholder"><h3>${product.name}</h3><p>圖片待補 / 綜合口味示意</p></div>`;

        const productCard = document.createElement('div');
        productCard.classList.add('product-card');
        productCard.innerHTML = `
            ${productImageHtml} <!-- 在這裡插入圖片或佔位符 -->
            <div class="product-content"> <!-- 新增一個 div 包裹文字內容 -->
                <h3>${product.name}</h3>
                <p class="description">${product.description}</p>
                <p class="price">
                    <span class="original-price">${isSpecialOffer ? '$' + product.originalPrice : ''}</span>
                    <span class="special-price">${specialPricePrefix}$${product.specialPrice}</span>
                </p>
                <div class="quantity-control">
                    <button data-id="${product.id}" data-action="decrease">-</button>
                    <input type="number" value="0" min="0" data-id="${product.id}" class="product-quantity-input">
                    <button data-id="${product.id}" data-action="increase">+</button>
                </div>
                <button class="btn primary-btn add-to-cart-btn" data-id="${product.id}">加入購物車</button>
            </div>
        `;
        productList.appendChild(productCard);
    });

    addEventListenersToProducts();
}


function addEventListenersToProducts() {
    document.querySelectorAll('.product-quantity-input').forEach(input => {
        input.addEventListener('change', (e) => {
            if (e.target.value < 0) e.target.value = 0; 
        });
    });


    document.querySelectorAll('.quantity-control button').forEach(button => {
        button.addEventListener('click', (e) => {
            const productId = e.target.dataset.id;
            const input = document.querySelector(`.product-quantity-input[data-id="${productId}"]`);
            let quantity = parseInt(input.value);
            if (e.target.dataset.action === 'increase') {
                quantity++;
            } else if (e.target.dataset.action === 'decrease' && quantity > 0) {
                quantity--;
            }
            input.value = quantity;
        });
    });


    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
        button.addEventListener('click', (e) => {
            const productId = e.target.dataset.id;
            const input = document.querySelector(`.product-quantity-input[data-id="${productId}"]`);
            const quantity = parseInt(input.value);
            if (quantity > 0) {
                addToCart(productId, quantity);
                input.value = 0; 
            } else {
                alert('請選擇欲加入的數量！');
            }
        });
    });
}


function addToCart(productId, quantity) {
    const existingItemIndex = cart.findIndex(item => item.productId === productId);
    if (existingItemIndex > -1) {
        cart[existingItemIndex].quantity += quantity;
    } else {
        cart.push({ productId, quantity });
    }
    updateCartDisplay();
}


function removeFromCart(productId) {
    cart = cart.filter(item => item.productId !== productId);
    updateCartDisplay();
}


function updateCartItemQuantity(productId, newQuantity) {
    const item = cart.find(item => item.productId === productId);
    if (item) {
        item.quantity = Math.max(0, newQuantity); 
        if (item.quantity === 0) {
            removeFromCart(productId); 
        } else {
            updateCartDisplay();
        }
    }
}


function calculateCartTotal() {
    let total = 0;
    cart.forEach(item => {
        const product = products.find(p => p.id === item.productId);
        if (product) {
            total += product.specialPrice * item.quantity;
        }
    });
    return total;
}


function renderCartItems() {
    if (!cartItemsDisplay) { 
        console.error('Error: #cart-items-display element not found.');
        return;
    }
    if (!cartSummarySection) { 
        console.error('Error: #cart-summary-section element not found.');
        return;
    }


    if (cart.length === 0) {
        cartItemsDisplay.innerHTML = '<p>購物車是空的。</p>';
        cartSummarySection.classList.add('hidden'); 
        return;
    }


    cartItemsDisplay.innerHTML = '';
    cart.forEach(item => {
        const product = products.find(p => p.id === item.productId); 
        if (product) {
            const cartItemDiv = document.createElement('div');
            cartItemDiv.classList.add('cart-item');
            cartItemDiv.innerHTML = `
                <div class="cart-item-info">
                    <h4>${product.name}</h4>
                    <span>${product.unit} @ $${product.specialPrice}</span>
                </div>
                <div class="cart-item-controls">
                    <div class="quantity-control">
                        <button data-id="${item.productId}" data-action="decrease-cart">-</button> 
                        <input type="number" value="${item.quantity}" min="0" data-id="${item.productId}" class="cart-quantity-input"> 
                        <button data-id="${item.productId}" data-action="increase-cart">+</button> 
                    </div>
                    <span class="item-subtotal">$${product.specialPrice * item.quantity}</span>
                    <button class="remove-btn" data-id="${item.productId}"><i class="fas fa-trash"></i></button> 
                </div>
            `;
            cartItemsDisplay.appendChild(cartItemDiv);
        }
    });


    // 為購物車明細中的數量控制和移除按鈕添加事件監聽器
    document.querySelectorAll('.cart-quantity-input').forEach(input => {
        input.addEventListener('change', (e) => {
            const productId = e.target.dataset.id;
            updateCartItemQuantity(productId, parseInt(e.target.value));
        });
    });


    document.querySelectorAll('.cart-item-controls button[data-action]').forEach(button => {
        button.addEventListener('click', (e) => {
            const productId = e.target.dataset.id;
            const input = document.querySelector(`.cart-quantity-input[data-id="${productId}"]`);
            let quantity = parseInt(input.value);
            if (e.target.dataset.action === 'increase-cart') {
                quantity++;
            } else if (e.target.dataset.action === 'decrease-cart' && quantity > 0) {
                quantity--;
            }
            updateCartItemQuantity(productId, quantity);
        });
    });


    document.querySelectorAll('.remove-btn').forEach(button => {
        button.addEventListener('click', (e) => {
            const productId = e.target.dataset.id;
            removeFromCart(productId);
        });
    });
}


function updateCartDisplay() {
    if (!cartCountSpan) { 
        console.error('Error: #cart-count element not found.');
        return;
    }
    if (!cartTotalAmountSpan) { 
        console.error('Error: #cart-total-amount element not found.');
        return;
    }
    
    cartCountSpan.textContent = cart.reduce((sum, item) => sum + item.quantity, 0); 
    cartTotalAmountSpan.textContent = `$${calculateCartTotal()}`;
    renderCartItems();


    if (cart.length > 0) {
        cartSummarySection.classList.remove('hidden');
    } else {
        cartSummarySection.classList.add('hidden');
    }
}


function clearCart() {
    cart = [];
    updateCartDisplay();
    alert('購物車已清空！');
}


function generateGoogleFormUrl() {
    if (cart.length === 0) {
        alert('您的購物車是空的，請先選擇商品！');
        return;
    }

    // 使用一個物件來儲存每個品項的最終數量，確保每個 entry.ID 只出現一次
    const quantitiesMap = {};
    
    // 1. 初始化所有品項的數量為 0
    for (const productId in PRODUCT_QUANTITY_ENTRY_IDS) {
        const entryId = PRODUCT_QUANTITY_ENTRY_IDS[productId];
        quantitiesMap[entryId] = 0; // 初始化為 0
    }

    // 2. 用購物車中的實際數量來更新這些值
    cart.forEach(item => {
        const entryId = PRODUCT_QUANTITY_ENTRY_IDS[item.productId];
        if (entryId) {
            quantitiesMap[entryId] = item.quantity; // 更新為實際選購數量
        } else {
            console.warn(`Warning: Missing entry ID for product ID: ${item.productId}`);
        }
    });

    // 3. 從 quantitiesMap 構建 formUrlParams 字串
    let formUrlParams = '';
    for (const entryId in quantitiesMap) {
        formUrlParams += `&entry.${entryId}=${quantitiesMap[entryId]}`;
    }

    const googleFormFinalUrl = `https://docs.google.com/forms/d/e/${GOOGLE_FORM_ID}/viewform?usp=pp_url${formUrlParams}`;

    console.log('生成的 Google 表單預填網址:', googleFormFinalUrl); // 重新啟用診斷
    window.location.replace(googleFormFinalUrl); 
}


// ====== 事件監聽器 ======


document.addEventListener('DOMContentLoaded', () => {
    try {
        // 在 DOMContentLoaded 內部獲取所有 DOM 元素，確保它們已經存在
        productList = document.getElementById('product-list');
        cartCountSpan = document.getElementById('cart-count');
        cartSummarySection = document.getElementById('cart-summary-section');
        cartItemsDisplay = document.getElementById('cart-items-display');
        cartTotalAmountSpan = document.getElementById('cart-total-amount');
        proceedToFormBtn = document.getElementById('proceed-to-form-btn');
        clearCartBtn = document.getElementById('clear-cart-btn');
        cartIcon = document.querySelector('.cart-icon');


        // 確保按鈕元素存在後再綁定事件
        if (proceedToFormBtn) {
            proceedToFormBtn.addEventListener('click', generateGoogleFormUrl);
        } else {
            console.error('Error: #proceed-to-form-btn not found. Cannot bind click event.');
        }
        if (clearCartBtn) {
            clearCartBtn.addEventListener('click', clearCart);
        } else {
            console.error('Error: #clear-cart-btn not found. Cannot bind click event.');
        }
        if (cartIcon) {
             cartIcon.addEventListener('click', () => {
                if (cart.length > 0) {
                    cartSummarySection.scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert('您的購物車是空的，請先選擇商品！');
                }
            });
        } else {
            console.error('Error: .cart-icon not found. Cannot bind click event.');
        }


        renderProducts();
        updateCartDisplay(); 
    } catch (e) {
        console.error('Error during initial product rendering or cart display:', e);
        alert('網頁載入發生錯誤，請稍後再試。錯誤訊息：' + e.message);
    }
});
    </script>
</body>
</html>






